<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 22 Automating analysis | Data Journalism with R and the Tidyverse</title>
  <meta name="description" content="This is a book built on a very opinionated philosophy for journalism students doing data journalism in R with replicable methods." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 22 Automating analysis | Data Journalism with R and the Tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book built on a very opinionated philosophy for journalism students doing data journalism in R with replicable methods." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 22 Automating analysis | Data Journalism with R and the Tidyverse" />
  
  <meta name="twitter:description" content="This is a book built on a very opinionated philosophy for journalism students doing data journalism in R with replicable methods." />
  

<meta name="author" content="Matt Waite (original author); updated by Derek Willis and Sean Mussenden" />


<meta name="date" content="2021-09-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="geographic-analysis.html"/>
<link rel="next" href="automating-geographic-analysis.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160712129-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160712129-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://smussenden.github.io/coursefiles/data_journalism_book/">Data Journalism With R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#modern-data-journalism"><i class="fa fa-check"></i><b>1.1</b> Modern data journalism</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installations"><i class="fa fa-check"></i><b>1.2</b> Installations</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.3</b> About this book</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#what-well-cover"><i class="fa fa-check"></i><b>1.4</b> What we’ll cover</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="public-records.html"><a href="public-records.html"><i class="fa fa-check"></i><b>2</b> Public records</a>
<ul>
<li class="chapter" data-level="2.1" data-path="public-records.html"><a href="public-records.html#federal-law"><i class="fa fa-check"></i><b>2.1</b> Federal law</a></li>
<li class="chapter" data-level="2.2" data-path="public-records.html"><a href="public-records.html#state-law"><i class="fa fa-check"></i><b>2.2</b> State law</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>3</b> R basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-basics.html"><a href="r-basics.html#about-libraries"><i class="fa fa-check"></i><b>3.1</b> About libraries</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html"><i class="fa fa-check"></i><b>4</b> Data journalism in the age of replication</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#the-stylebook"><i class="fa fa-check"></i><b>4.1</b> The stylebook</a></li>
<li class="chapter" data-level="4.2" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#replication"><i class="fa fa-check"></i><b>4.2</b> Replication</a></li>
<li class="chapter" data-level="4.3" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#goodbye-excel"><i class="fa fa-check"></i><b>4.3</b> Goodbye Excel?</a></li>
<li class="chapter" data-level="4.4" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#receptivity-is-high"><i class="fa fa-check"></i><b>4.4</b> “Receptivity … is high”</a></li>
<li class="chapter" data-level="4.5" data-path="data-journalism-in-the-age-of-replication.html"><a href="data-journalism-in-the-age-of-replication.html#replication-in-notebooks"><i class="fa fa-check"></i><b>4.5</b> Replication in notebooks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html"><i class="fa fa-check"></i><b>5</b> Data, structures and types</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#a-mental-picture"><i class="fa fa-check"></i><b>5.1</b> A Mental Picture</a></li>
<li class="chapter" data-level="5.2" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#types"><i class="fa fa-check"></i><b>5.2</b> Types</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="aggregates.html"><a href="aggregates.html"><i class="fa fa-check"></i><b>6</b> Aggregates</a>
<ul>
<li class="chapter" data-level="6.1" data-path="aggregates.html"><a href="aggregates.html#libraries"><i class="fa fa-check"></i><b>6.1</b> Libraries</a></li>
<li class="chapter" data-level="6.2" data-path="aggregates.html"><a href="aggregates.html#importing-data"><i class="fa fa-check"></i><b>6.2</b> Importing data</a></li>
<li class="chapter" data-level="6.3" data-path="aggregates.html"><a href="aggregates.html#group-by-and-count"><i class="fa fa-check"></i><b>6.3</b> Group by and count</a></li>
<li class="chapter" data-level="6.4" data-path="aggregates.html"><a href="aggregates.html#other-summarization-methods-summing-mean-median-min-and-max"><i class="fa fa-check"></i><b>6.4</b> Other summarization methods: summing, mean, median, min and max</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mutating-data.html"><a href="mutating-data.html"><i class="fa fa-check"></i><b>7</b> Mutating data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mutating-data.html"><a href="mutating-data.html#another-use-of-mutate"><i class="fa fa-check"></i><b>7.1</b> Another use of mutate</a></li>
<li class="chapter" data-level="7.2" data-path="mutating-data.html"><a href="mutating-data.html#a-more-powerful-use"><i class="fa fa-check"></i><b>7.2</b> A more powerful use</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="working-with-dates.html"><a href="working-with-dates.html"><i class="fa fa-check"></i><b>8</b> Working with dates</a>
<ul>
<li class="chapter" data-level="8.1" data-path="working-with-dates.html"><a href="working-with-dates.html#the-hard-way"><i class="fa fa-check"></i><b>8.1</b> The hard way</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="filters-and-selections.html"><a href="filters-and-selections.html"><i class="fa fa-check"></i><b>9</b> Filters and selections</a>
<ul>
<li class="chapter" data-level="9.1" data-path="filters-and-selections.html"><a href="filters-and-selections.html#combining-filters"><i class="fa fa-check"></i><b>9.1</b> Combining filters</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html"><i class="fa fa-check"></i><b>10</b> Data Cleaning Part I: Data smells</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#wrong-type"><i class="fa fa-check"></i><b>10.1</b> Wrong Type</a></li>
<li class="chapter" data-level="10.2" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#missing-data"><i class="fa fa-check"></i><b>10.2</b> Missing Data</a></li>
<li class="chapter" data-level="10.3" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#gaps-in-data"><i class="fa fa-check"></i><b>10.3</b> Gaps in data</a></li>
<li class="chapter" data-level="10.4" data-path="data-cleaning-part-i-data-smells.html"><a href="data-cleaning-part-i-data-smells.html#supicious-outliers"><i class="fa fa-check"></i><b>10.4</b> Supicious Outliers</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html"><i class="fa fa-check"></i><b>11</b> Data Cleaning Part II: Janitor</a>
<ul>
<li class="chapter" data-level="11.1" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#cleaning-headers"><i class="fa fa-check"></i><b>11.1</b> Cleaning headers</a></li>
<li class="chapter" data-level="11.2" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#changing-data-types"><i class="fa fa-check"></i><b>11.2</b> Changing data types</a></li>
<li class="chapter" data-level="11.3" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#duplicates"><i class="fa fa-check"></i><b>11.3</b> Duplicates</a></li>
<li class="chapter" data-level="11.4" data-path="data-cleaning-part-ii-janitor.html"><a href="data-cleaning-part-ii-janitor.html#cleaning-strings"><i class="fa fa-check"></i><b>11.4</b> Cleaning strings</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="data-cleaning-part-iii-open-refine.html"><a href="data-cleaning-part-iii-open-refine.html"><i class="fa fa-check"></i><b>12</b> Data Cleaning Part III: Open Refine</a>
<ul>
<li class="chapter" data-level="12.1" data-path="data-cleaning-part-iii-open-refine.html"><a href="data-cleaning-part-iii-open-refine.html#refinr-open-refine-in-r"><i class="fa fa-check"></i><b>12.1</b> Refinr, Open Refine in R</a></li>
<li class="chapter" data-level="12.2" data-path="data-cleaning-part-iii-open-refine.html"><a href="data-cleaning-part-iii-open-refine.html#manually-cleaning-data-with-open-refine"><i class="fa fa-check"></i><b>12.2</b> Manually cleaning data with Open Refine</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html"><i class="fa fa-check"></i><b>13</b> Cleaning Data Part IV: PDFs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html#easy-does-it"><i class="fa fa-check"></i><b>13.1</b> Easy does it</a></li>
<li class="chapter" data-level="13.2" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html#when-it-looks-good-but-needs-a-little-fixing"><i class="fa fa-check"></i><b>13.2</b> When it looks good, but needs a little fixing</a></li>
<li class="chapter" data-level="13.3" data-path="cleaning-data-part-iv-pdfs.html"><a href="cleaning-data-part-iv-pdfs.html#cleaning-up-the-data-in-r"><i class="fa fa-check"></i><b>13.3</b> Cleaning up the data in R</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="combining-and-joining.html"><a href="combining-and-joining.html"><i class="fa fa-check"></i><b>14</b> Combining and joining</a>
<ul>
<li class="chapter" data-level="14.1" data-path="combining-and-joining.html"><a href="combining-and-joining.html#combining-data-stacking"><i class="fa fa-check"></i><b>14.1</b> Combining data (stacking)</a></li>
<li class="chapter" data-level="14.2" data-path="combining-and-joining.html"><a href="combining-and-joining.html#joining-data"><i class="fa fa-check"></i><b>14.2</b> Joining data</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="scraping-data-with-rvest.html"><a href="scraping-data-with-rvest.html"><i class="fa fa-check"></i><b>15</b> Scraping data with Rvest</a>
<ul>
<li class="chapter" data-level="15.1" data-path="scraping-data-with-rvest.html"><a href="scraping-data-with-rvest.html#a-more-difficult-example"><i class="fa fa-check"></i><b>15.1</b> A more difficult example</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="advanced-rvest.html"><a href="advanced-rvest.html"><i class="fa fa-check"></i><b>16</b> Advanced rvest</a></li>
<li class="chapter" data-level="17" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html"><i class="fa fa-check"></i><b>17</b> Intro to APIs: The Census</a>
<ul>
<li class="chapter" data-level="17.1" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html#the-acs"><i class="fa fa-check"></i><b>17.1</b> The ACS</a></li>
<li class="chapter" data-level="17.2" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html#wide-results"><i class="fa fa-check"></i><b>17.2</b> “Wide” Results</a></li>
<li class="chapter" data-level="17.3" data-path="intro-to-apis-the-census.html"><a href="intro-to-apis-the-census.html#sorting-results"><i class="fa fa-check"></i><b>17.3</b> Sorting Results</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="visualizing-your-data-for-reporting.html"><a href="visualizing-your-data-for-reporting.html"><i class="fa fa-check"></i><b>18</b> Visualizing your data for reporting</a>
<ul>
<li class="chapter" data-level="18.1" data-path="visualizing-your-data-for-reporting.html"><a href="visualizing-your-data-for-reporting.html#bar-charts"><i class="fa fa-check"></i><b>18.1</b> Bar charts</a></li>
<li class="chapter" data-level="18.2" data-path="visualizing-your-data-for-reporting.html"><a href="visualizing-your-data-for-reporting.html#line-charts"><i class="fa fa-check"></i><b>18.2</b> Line charts</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="visualizing-your-data-for-publication.html"><a href="visualizing-your-data-for-publication.html"><i class="fa fa-check"></i><b>19</b> Visualizing your data for publication</a>
<ul>
<li class="chapter" data-level="19.1" data-path="visualizing-your-data-for-publication.html"><a href="visualizing-your-data-for-publication.html#datawrapper"><i class="fa fa-check"></i><b>19.1</b> Datawrapper</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="geographic-data-basics.html"><a href="geographic-data-basics.html"><i class="fa fa-check"></i><b>20</b> Geographic data basics</a>
<ul>
<li class="chapter" data-level="20.1" data-path="geographic-data-basics.html"><a href="geographic-data-basics.html#importing-and-viewing-data"><i class="fa fa-check"></i><b>20.1</b> Importing and viewing data</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="geographic-analysis.html"><a href="geographic-analysis.html"><i class="fa fa-check"></i><b>21</b> Geographic analysis</a>
<ul>
<li class="chapter" data-level="21.1" data-path="geographic-analysis.html"><a href="geographic-analysis.html#why-tidycensus-is-so-useful"><i class="fa fa-check"></i><b>21.1</b> Why tidycensus is so useful</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="automating-analysis.html"><a href="automating-analysis.html"><i class="fa fa-check"></i><b>22</b> Automating analysis</a>
<ul>
<li class="chapter" data-level="22.1" data-path="automating-analysis.html"><a href="automating-analysis.html#automating-downloads-an-imports"><i class="fa fa-check"></i><b>22.1</b> Automating downloads an imports</a></li>
<li class="chapter" data-level="22.2" data-path="automating-analysis.html"><a href="automating-analysis.html#exploring-the-data"><i class="fa fa-check"></i><b>22.2</b> Exploring the data</a></li>
<li class="chapter" data-level="22.3" data-path="automating-analysis.html"><a href="automating-analysis.html#analysis"><i class="fa fa-check"></i><b>22.3</b> Analysis</a></li>
<li class="chapter" data-level="22.4" data-path="automating-analysis.html"><a href="automating-analysis.html#making-updating-graphics"><i class="fa fa-check"></i><b>22.4</b> Making updating graphics</a></li>
<li class="chapter" data-level="22.5" data-path="automating-analysis.html"><a href="automating-analysis.html#the-state-vs-the-feds"><i class="fa fa-check"></i><b>22.5</b> The State vs the Feds</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="automating-geographic-analysis.html"><a href="automating-geographic-analysis.html"><i class="fa fa-check"></i><b>23</b> Automating geographic analysis</a>
<ul>
<li class="chapter" data-level="23.1" data-path="automating-geographic-analysis.html"><a href="automating-geographic-analysis.html#mapping-continuously"><i class="fa fa-check"></i><b>23.1</b> Mapping continuously</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="basic-stats-the-t-test.html"><a href="basic-stats-the-t-test.html"><i class="fa fa-check"></i><b>24</b> Basic Stats: The T-Test</a>
<ul>
<li class="chapter" data-level="24.1" data-path="basic-stats-the-t-test.html"><a href="basic-stats-the-t-test.html#specific-call-types"><i class="fa fa-check"></i><b>24.1</b> Specific call types</a></li>
<li class="chapter" data-level="24.2" data-path="basic-stats-the-t-test.html"><a href="basic-stats-the-t-test.html#what-else-should-we-look-at"><i class="fa fa-check"></i><b>24.2</b> What else should we look at?</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="an-intro-to-text-analysis.html"><a href="an-intro-to-text-analysis.html"><i class="fa fa-check"></i><b>25</b> An intro to text analysis</a>
<ul>
<li class="chapter" data-level="25.1" data-path="an-intro-to-text-analysis.html"><a href="an-intro-to-text-analysis.html#going-further-by-analyzing-text"><i class="fa fa-check"></i><b>25.1</b> Going further by analyzing text</a></li>
<li class="chapter" data-level="25.2" data-path="an-intro-to-text-analysis.html"><a href="an-intro-to-text-analysis.html#going-beyond-a-single-word"><i class="fa fa-check"></i><b>25.2</b> Going beyond a single word</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html"><i class="fa fa-check"></i><b>26</b> Writing with numbers</a>
<ul>
<li class="chapter" data-level="26.1" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html#how-to-write-about-numbers-without-overwhelming-with-numbers."><i class="fa fa-check"></i><b>26.1</b> How to write about numbers without overwhelming with numbers.</a></li>
<li class="chapter" data-level="26.2" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html#when-exact-numbers-matter"><i class="fa fa-check"></i><b>26.2</b> When exact numbers matter</a></li>
<li class="chapter" data-level="26.3" data-path="writing-with-numbers.html"><a href="writing-with-numbers.html#an-example"><i class="fa fa-check"></i><b>26.3</b> An example</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html"><i class="fa fa-check"></i><b>27</b> Ethics in data journalism</a>
<ul>
<li class="chapter" data-level="27.1" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#problems"><i class="fa fa-check"></i><b>27.1</b> Problems</a></li>
<li class="chapter" data-level="27.2" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#the-googlebot"><i class="fa fa-check"></i><b>27.2</b> The Googlebot</a></li>
<li class="chapter" data-level="27.3" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#data-lifetimes"><i class="fa fa-check"></i><b>27.3</b> Data Lifetimes</a></li>
<li class="chapter" data-level="27.4" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#you-are-a-data-provider"><i class="fa fa-check"></i><b>27.4</b> You Are a Data Provider</a></li>
<li class="chapter" data-level="27.5" data-path="ethics-in-data-journalism.html"><a href="ethics-in-data-journalism.html#ethical-data"><i class="fa fa-check"></i><b>27.5</b> Ethical Data</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="using-github.html"><a href="using-github.html"><i class="fa fa-check"></i><b>28</b> Using GitHub</a>
<ul>
<li class="chapter" data-level="28.1" data-path="using-github.html"><a href="using-github.html#how-it-works"><i class="fa fa-check"></i><b>28.1</b> How It Works</a></li>
<li class="chapter" data-level="28.2" data-path="using-github.html"><a href="using-github.html#getting-started"><i class="fa fa-check"></i><b>28.2</b> Getting Started</a></li>
<li class="chapter" data-level="28.3" data-path="using-github.html"><a href="using-github.html#advanced-use"><i class="fa fa-check"></i><b>28.3</b> Advanced Use</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Journalism with R and the Tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automating-analysis" class="section level1" number="22">
<h1><span class="header-section-number">Chapter 22</span> Automating analysis</h1>
<p>Many of the data analyses that you do will be largely one-off efforts – you’re going to do the analysis and write the story and be done. Maybe you’ll come back to it in a couple of months or years, but really you’re just doing it once.</p>
<p>But what happens when you have a long-running story, where you’re going to update it every day, or every week? What changes when you’re writing that code?</p>
<ol style="list-style-type: decimal">
<li>How will this run again without changing anything?</li>
<li>What questions do you have that have to be answered each time?</li>
<li>What changes when you have to repeat questions to changing data?</li>
</ol>
<p>The global COVID-19 pandemic is something we’re going to be writing about and covering for some time. One element of it – one that materialized in Nebraska as I am writing this – is a tsunami of first time joblessness claims for unemployment assistance. That data is regularly published, and we’re going to be talking about it weekly for a long time. So it’s the ideal candidate for repeating analysis – scripting the questions we want to answer every week and doing so in a way that we can just load it without having to change anything.</p>
<p>Let’s get some new libraries to our typical tidyverse import. First, I’m going to add a library called <code>readxl</code>, which does what you think it does. It reads Microsoft Excel files. The next one I’m going to add is <code>DT</code>. It stands for datatables, and it makes your dataframes into html tables that are browsable and searchable. This is a bigger issue for me – the author who is turning these into html pages – than you, working in your notebooks. We’re also going to add a library called ggrepel, which assists in putting tables on dots in charts.</p>
<p>You install them the same way you do anything else – <code>install.packages("readxl")</code> and <code>install.packages("DT")</code> and <code>install.packages("ggrepel")</code>.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="automating-analysis.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb352-2"><a href="automating-analysis.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb352-3"><a href="automating-analysis.html#cb352-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb352-4"><a href="automating-analysis.html#cb352-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb352-5"><a href="automating-analysis.html#cb352-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span></code></pre></div>
<div id="automating-downloads-an-imports" class="section level2" number="22.1">
<h2><span class="header-section-number">22.1</span> Automating downloads an imports</h2>
<p>Nebraska <a href="https://neworks.nebraska.gov/gsipub/index.asp?docid=710">publishes data weekly on first time unemployment claims on the state Department of Labor website</a>.</p>
<p>There’s four datasets. We’re looking at the weekly initial claims from 2012 to present. If you click it, you’ll get an Excel spreadsheet. That’s a problem, given that we’ve been working with CSVs all along. So the problem we have before us is this: Have to download it first, then open an Excel file with multiple sheets and lots of header and footers.</p>
<p>There’s a multitude of ways to get data from a website, but base R has a simple function to just download a file and name it. Couldn’t be easier. Right or control click on the link for the 2012 to 2020 initial claims data and copy the link location. Then use this function:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="automating-analysis.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://neworks.nebraska.gov/admin/gsipub/htmlarea/uploads/NE%20UI%20Weekly%20Initial%20Claims.xlsx&quot;</span>, <span class="at">destfile =</span> <span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>)</span></code></pre></div>
<p>Open the file in Excel so you can see what we’re working with. The first sheet is just definitions and explanations. Then each sheet is a year (or year to date) of data. Some have footers. Some don’t. Some have a headline. Some don’t. So we have some work ahead of us.</p>
<p>There are better ways to do this, and if your author was better at this, I’d tell you about it. But for beginners and people who aren’t totally sure of themselves, explicit is better than implicit. So instead of using programming magic, we’re going to use copy and paste. My programmer friends just died inside a little, but done is better than clever.</p>
<p>What we need to do, in words, is this:</p>
<ol style="list-style-type: decimal">
<li>Read a specific sheet</li>
<li>Skip the top row</li>
<li>Clean the column names with janitor.</li>
<li>Select just the first two rows, which will help us chop out some garbage.</li>
<li>We need to find if the sheet has that source line at the end of the data, so we’ll use <code>str_detect</code> in <code>stringr</code> and filter it out.</li>
<li>We’ll use janitor to remove any empty rows and columns</li>
<li>And lastly, we’ll convert all the numbers in initial_claims to actual numbers, because the Source line made them character on import.</li>
</ol>
<p>It’s a lot, but not really. Each step is very simple, and is designed to solve one problem. And after we do it with one, we’ll do it with the next, and the next, and the next, so on and so forth.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="automating-analysis.html#cb354-1" aria-hidden="true" tabindex="-1"></a>weeklyclaims20 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">2</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb354-2"><a href="automating-analysis.html#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb354-3"><a href="automating-analysis.html#cb354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb354-4"><a href="automating-analysis.html#cb354-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb354-5"><a href="automating-analysis.html#cb354-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb354-6"><a href="automating-analysis.html#cb354-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...3
## * `` -&gt; ...4
## * `` -&gt; ...5</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="automating-analysis.html#cb356-1" aria-hidden="true" tabindex="-1"></a>weeklyclaims19 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">3</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-2"><a href="automating-analysis.html#cb356-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-3"><a href="automating-analysis.html#cb356-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb356-4"><a href="automating-analysis.html#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb356-5"><a href="automating-analysis.html#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...3
## * `` -&gt; ...4
## * `` -&gt; ...5</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="automating-analysis.html#cb358-1" aria-hidden="true" tabindex="-1"></a>weeklyclaims18 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">4</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-2"><a href="automating-analysis.html#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="automating-analysis.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-4"><a href="automating-analysis.html#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-5"><a href="automating-analysis.html#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-6"><a href="automating-analysis.html#cb358-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span>
<span id="cb358-7"><a href="automating-analysis.html#cb358-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-8"><a href="automating-analysis.html#cb358-8" aria-hidden="true" tabindex="-1"></a>weeklyclaims17 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">5</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-9"><a href="automating-analysis.html#cb358-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-10"><a href="automating-analysis.html#cb358-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-11"><a href="automating-analysis.html#cb358-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-12"><a href="automating-analysis.html#cb358-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-13"><a href="automating-analysis.html#cb358-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span>
<span id="cb358-14"><a href="automating-analysis.html#cb358-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-15"><a href="automating-analysis.html#cb358-15" aria-hidden="true" tabindex="-1"></a>weeklyclaims16 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">6</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-16"><a href="automating-analysis.html#cb358-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-17"><a href="automating-analysis.html#cb358-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-18"><a href="automating-analysis.html#cb358-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-19"><a href="automating-analysis.html#cb358-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-20"><a href="automating-analysis.html#cb358-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span>
<span id="cb358-21"><a href="automating-analysis.html#cb358-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-22"><a href="automating-analysis.html#cb358-22" aria-hidden="true" tabindex="-1"></a>weeklyclaims15 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">7</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-23"><a href="automating-analysis.html#cb358-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-24"><a href="automating-analysis.html#cb358-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-25"><a href="automating-analysis.html#cb358-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-26"><a href="automating-analysis.html#cb358-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-27"><a href="automating-analysis.html#cb358-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span>
<span id="cb358-28"><a href="automating-analysis.html#cb358-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-29"><a href="automating-analysis.html#cb358-29" aria-hidden="true" tabindex="-1"></a>weeklyclaims14 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">8</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-30"><a href="automating-analysis.html#cb358-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-31"><a href="automating-analysis.html#cb358-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-32"><a href="automating-analysis.html#cb358-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-33"><a href="automating-analysis.html#cb358-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-34"><a href="automating-analysis.html#cb358-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span>
<span id="cb358-35"><a href="automating-analysis.html#cb358-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-36"><a href="automating-analysis.html#cb358-36" aria-hidden="true" tabindex="-1"></a>weeklyclaims13 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">9</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-37"><a href="automating-analysis.html#cb358-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-38"><a href="automating-analysis.html#cb358-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-39"><a href="automating-analysis.html#cb358-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-40"><a href="automating-analysis.html#cb358-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-41"><a href="automating-analysis.html#cb358-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span>
<span id="cb358-42"><a href="automating-analysis.html#cb358-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-43"><a href="automating-analysis.html#cb358-43" aria-hidden="true" tabindex="-1"></a>weeklyclaims12 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;weeklyinitialclaims.xlsx&quot;</span>, <span class="at">sheet=</span><span class="dv">10</span>, <span class="at">skip=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-44"><a href="automating-analysis.html#cb358-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb358-45"><a href="automating-analysis.html#cb358-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-46"><a href="automating-analysis.html#cb358-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(initial_claims, <span class="st">&quot;Source&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-47"><a href="automating-analysis.html#cb358-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="fu">c</span>(<span class="st">&quot;cols&quot;</span>, <span class="st">&quot;rows&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb358-48"><a href="automating-analysis.html#cb358-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">initial_claims =</span> <span class="fu">as.numeric</span>(initial_claims))</span></code></pre></div>
<p>Now we need to combine all those tables together. We can do that with rbind and some convenient overwriting of a dataframe to add new data each time.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="automating-analysis.html#cb359-1" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims12, weeklyclaims13)</span>
<span id="cb359-2"><a href="automating-analysis.html#cb359-2" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims14)</span>
<span id="cb359-3"><a href="automating-analysis.html#cb359-3" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims15)</span>
<span id="cb359-4"><a href="automating-analysis.html#cb359-4" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims16)</span>
<span id="cb359-5"><a href="automating-analysis.html#cb359-5" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims17)</span>
<span id="cb359-6"><a href="automating-analysis.html#cb359-6" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims18)</span>
<span id="cb359-7"><a href="automating-analysis.html#cb359-7" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims19)</span>
<span id="cb359-8"><a href="automating-analysis.html#cb359-8" aria-hidden="true" tabindex="-1"></a>weeklyclaims <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weeklyclaims, weeklyclaims20)</span></code></pre></div>
</div>
<div id="exploring-the-data" class="section level2" number="22.2">
<h2><span class="header-section-number">22.2</span> Exploring the data</h2>
<p>Let’s take a look at what we have, using datatables. The formatDate business just makes the date look nicer.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="automating-analysis.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(weeklyclaims) <span class="sc">%&gt;%</span> <span class="fu">formatDate</span>(<span class="dv">1</span>, <span class="st">&quot;toLocaleDateString&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-549d8d6e2797280b9691" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-549d8d6e2797280b9691">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427"],["2012-01-07T00:00:00Z","2012-01-14T00:00:00Z","2012-01-21T00:00:00Z","2012-01-28T00:00:00Z","2012-02-04T00:00:00Z","2012-02-11T00:00:00Z","2012-02-18T00:00:00Z","2012-02-25T00:00:00Z","2012-03-03T00:00:00Z","2012-03-10T00:00:00Z","2012-03-17T00:00:00Z","2012-03-24T00:00:00Z","2012-03-31T00:00:00Z","2012-04-07T00:00:00Z","2012-04-14T00:00:00Z","2012-04-21T00:00:00Z","2012-04-28T00:00:00Z","2012-05-05T00:00:00Z","2012-05-12T00:00:00Z","2012-05-19T00:00:00Z","2012-05-26T00:00:00Z","2012-06-02T00:00:00Z","2012-06-09T00:00:00Z","2012-06-16T00:00:00Z","2012-06-23T00:00:00Z","2012-06-30T00:00:00Z","2012-07-07T00:00:00Z","2012-07-14T00:00:00Z","2012-07-21T00:00:00Z","2012-07-28T00:00:00Z","2012-08-04T00:00:00Z","2012-08-11T00:00:00Z","2012-08-18T00:00:00Z","2012-08-25T00:00:00Z","2012-09-01T00:00:00Z","2012-09-08T00:00:00Z","2012-09-15T00:00:00Z","2012-09-22T00:00:00Z","2012-09-29T00:00:00Z","2012-10-06T00:00:00Z","2012-10-13T00:00:00Z","2012-10-20T00:00:00Z","2012-10-27T00:00:00Z","2012-11-03T00:00:00Z","2012-11-10T00:00:00Z","2012-11-17T00:00:00Z","2012-11-24T00:00:00Z","2012-12-01T00:00:00Z","2012-12-08T00:00:00Z","2012-12-15T00:00:00Z","2012-12-22T00:00:00Z","2012-12-29T00:00:00Z","2013-01-05T00:00:00Z","2013-01-12T00:00:00Z","2013-01-19T00:00:00Z","2013-01-26T00:00:00Z","2013-02-02T00:00:00Z","2013-02-09T00:00:00Z","2013-02-16T00:00:00Z","2013-02-23T00:00:00Z","2013-03-02T00:00:00Z","2013-03-09T00:00:00Z","2013-03-16T00:00:00Z","2013-03-23T00:00:00Z","2013-03-30T00:00:00Z","2013-04-06T00:00:00Z","2013-04-13T00:00:00Z","2013-04-20T00:00:00Z","2013-04-27T00:00:00Z","2013-05-04T00:00:00Z","2013-05-11T00:00:00Z","2013-05-18T00:00:00Z","2013-05-25T00:00:00Z","2013-06-01T00:00:00Z","2013-06-08T00:00:00Z","2013-06-15T00:00:00Z","2013-06-22T00:00:00Z","2013-06-29T00:00:00Z","2013-07-06T00:00:00Z","2013-07-13T00:00:00Z","2013-07-20T00:00:00Z","2013-07-27T00:00:00Z","2013-08-03T00:00:00Z","2013-08-10T00:00:00Z","2013-08-17T00:00:00Z","2013-08-24T00:00:00Z","2013-08-31T00:00:00Z","2013-09-07T00:00:00Z","2013-09-14T00:00:00Z","2013-09-21T00:00:00Z","2013-09-28T00:00:00Z","2013-10-05T00:00:00Z","2013-10-12T00:00:00Z","2013-10-19T00:00:00Z","2013-10-26T00:00:00Z","2013-11-02T00:00:00Z","2013-11-09T00:00:00Z","2013-11-16T00:00:00Z","2013-11-23T00:00:00Z","2013-11-30T00:00:00Z","2013-12-07T00:00:00Z","2013-12-14T00:00:00Z","2013-12-21T00:00:00Z","2013-12-28T00:00:00Z","2014-01-04T00:00:00Z","2014-01-11T00:00:00Z","2014-01-18T00:00:00Z","2014-01-25T00:00:00Z","2014-02-01T00:00:00Z","2014-02-08T00:00:00Z","2014-02-15T00:00:00Z","2014-02-22T00:00:00Z","2014-03-01T00:00:00Z","2014-03-08T00:00:00Z","2014-03-15T00:00:00Z","2014-03-22T00:00:00Z","2014-03-29T00:00:00Z","2014-04-05T00:00:00Z","2014-04-12T00:00:00Z","2014-04-19T00:00:00Z","2014-04-26T00:00:00Z","2014-05-03T00:00:00Z","2014-05-10T00:00:00Z","2014-05-17T00:00:00Z","2014-05-24T00:00:00Z","2014-05-31T00:00:00Z","2014-06-07T00:00:00Z","2014-06-14T00:00:00Z","2014-06-21T00:00:00Z","2014-06-28T00:00:00Z","2014-07-05T00:00:00Z","2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-08-02T00:00:00Z","2014-08-09T00:00:00Z","2014-08-16T00:00:00Z","2014-08-23T00:00:00Z","2014-08-30T00:00:00Z","2014-09-06T00:00:00Z","2014-09-13T00:00:00Z","2014-09-20T00:00:00Z","2014-09-27T00:00:00Z","2014-10-04T00:00:00Z","2014-10-11T00:00:00Z","2014-10-18T00:00:00Z","2014-10-25T00:00:00Z","2014-11-01T00:00:00Z","2014-11-08T00:00:00Z","2014-11-15T00:00:00Z","2014-11-22T00:00:00Z","2014-11-29T00:00:00Z","2014-12-06T00:00:00Z","2014-12-13T00:00:00Z","2014-12-20T00:00:00Z","2014-12-27T00:00:00Z","2015-01-03T00:00:00Z","2015-01-10T00:00:00Z","2015-01-17T00:00:00Z","2015-01-24T00:00:00Z","2015-01-31T00:00:00Z","2015-02-07T00:00:00Z","2015-02-14T00:00:00Z","2015-02-21T00:00:00Z","2015-02-28T00:00:00Z","2015-03-07T00:00:00Z","2015-03-14T00:00:00Z","2015-03-21T00:00:00Z","2014-03-28T00:00:00Z","2015-04-04T00:00:00Z","2015-04-11T00:00:00Z","2015-04-18T00:00:00Z","2015-04-25T00:00:00Z","2015-05-02T00:00:00Z","2015-05-09T00:00:00Z","2015-05-16T00:00:00Z","2015-05-23T00:00:00Z","2015-05-30T00:00:00Z","2015-06-06T00:00:00Z","2015-06-13T00:00:00Z","2015-06-20T00:00:00Z","2015-06-27T00:00:00Z","2015-07-04T00:00:00Z","2015-07-11T00:00:00Z","2015-07-18T00:00:00Z","2015-07-25T00:00:00Z","2015-08-01T00:00:00Z","2015-08-08T00:00:00Z","2015-08-15T00:00:00Z","2015-08-22T00:00:00Z","2015-08-29T00:00:00Z","2015-09-05T00:00:00Z","2015-09-12T00:00:00Z","2015-09-19T00:00:00Z","2015-09-26T00:00:00Z","2015-10-03T00:00:00Z","2015-10-10T00:00:00Z","2015-10-17T00:00:00Z","2015-10-24T00:00:00Z","2015-10-31T00:00:00Z","2015-11-07T00:00:00Z","2015-11-14T00:00:00Z","2015-11-21T00:00:00Z","2015-11-28T00:00:00Z","2015-12-05T00:00:00Z","2015-12-12T00:00:00Z","2015-12-19T00:00:00Z","2015-12-26T00:00:00Z","2016-01-02T00:00:00Z","2016-01-09T00:00:00Z","2016-01-16T00:00:00Z","2016-01-23T00:00:00Z","2016-01-30T00:00:00Z","2016-02-06T00:00:00Z","2016-02-13T00:00:00Z","2016-02-20T00:00:00Z","2016-02-27T00:00:00Z","2016-03-05T00:00:00Z","2016-03-12T00:00:00Z","2016-03-19T00:00:00Z","2016-03-26T00:00:00Z","2016-04-02T00:00:00Z","2016-04-09T00:00:00Z","2016-04-16T00:00:00Z","2016-04-23T00:00:00Z","2016-04-30T00:00:00Z","2016-05-07T00:00:00Z","2016-05-14T00:00:00Z","2016-05-21T00:00:00Z","2016-05-28T00:00:00Z","2016-06-04T00:00:00Z","2016-06-11T00:00:00Z","2016-06-18T00:00:00Z","2016-06-25T00:00:00Z","2016-07-02T00:00:00Z","2016-07-09T00:00:00Z","2016-07-16T00:00:00Z","2016-07-23T00:00:00Z","2016-07-30T00:00:00Z","2016-08-06T00:00:00Z","2016-08-13T00:00:00Z","2016-08-20T00:00:00Z","2016-08-27T00:00:00Z","2016-09-03T00:00:00Z","2016-09-10T00:00:00Z","2016-09-17T00:00:00Z","2016-09-24T00:00:00Z","2016-10-01T00:00:00Z","2016-10-08T00:00:00Z","2016-10-15T00:00:00Z","2016-10-22T00:00:00Z","2016-10-29T00:00:00Z","2016-11-05T00:00:00Z","2016-11-12T00:00:00Z","2016-11-19T00:00:00Z","2016-11-26T00:00:00Z","2016-12-03T00:00:00Z","2016-12-10T00:00:00Z","2016-12-17T00:00:00Z","2016-12-24T00:00:00Z","2016-12-31T00:00:00Z","2017-01-07T00:00:00Z","2017-01-14T00:00:00Z","2017-01-21T00:00:00Z","2017-01-28T00:00:00Z","2017-02-04T00:00:00Z","2017-02-11T00:00:00Z","2017-02-18T00:00:00Z","2017-02-25T00:00:00Z","2017-03-04T00:00:00Z","2017-03-11T00:00:00Z","2017-03-18T00:00:00Z","2017-03-25T00:00:00Z","2017-04-01T00:00:00Z","2017-04-08T00:00:00Z","2017-04-15T00:00:00Z","2017-04-22T00:00:00Z","2017-04-29T00:00:00Z","2017-05-06T00:00:00Z","2017-05-13T00:00:00Z","2017-05-20T00:00:00Z","2017-05-27T00:00:00Z","2017-06-03T00:00:00Z","2017-06-10T00:00:00Z","2017-06-17T00:00:00Z","2017-06-24T00:00:00Z","2017-07-01T00:00:00Z","2017-07-08T00:00:00Z","2017-07-15T00:00:00Z","2017-07-22T00:00:00Z","2017-07-29T00:00:00Z","2017-08-05T00:00:00Z","2017-08-12T00:00:00Z","2017-08-19T00:00:00Z","2017-08-26T00:00:00Z","2017-09-02T00:00:00Z","2017-09-09T00:00:00Z","2017-09-16T00:00:00Z","2017-09-23T00:00:00Z","2017-09-30T00:00:00Z","2017-10-07T00:00:00Z","2017-10-14T00:00:00Z","2017-10-21T00:00:00Z","2017-10-28T00:00:00Z","2017-11-04T00:00:00Z","2017-11-11T00:00:00Z","2017-11-18T00:00:00Z","2017-11-25T00:00:00Z","2017-12-02T00:00:00Z","2017-12-09T00:00:00Z","2017-12-16T00:00:00Z","2017-12-23T00:00:00Z","2017-12-30T00:00:00Z","2018-01-06T00:00:00Z","2018-01-13T00:00:00Z","2018-01-20T00:00:00Z","2018-01-27T00:00:00Z","2018-02-03T00:00:00Z","2018-02-10T00:00:00Z","2018-02-17T00:00:00Z","2018-02-24T00:00:00Z","2018-03-03T00:00:00Z","2018-03-10T00:00:00Z","2018-03-17T00:00:00Z","2018-03-24T00:00:00Z","2018-03-31T00:00:00Z","2018-04-07T00:00:00Z","2018-04-14T00:00:00Z","2018-04-21T00:00:00Z","2018-04-28T00:00:00Z","2018-05-05T00:00:00Z","2018-05-12T00:00:00Z","2018-05-19T00:00:00Z","2018-05-26T00:00:00Z","2018-06-02T00:00:00Z","2018-06-09T00:00:00Z","2018-06-16T00:00:00Z","2018-06-23T00:00:00Z","2018-06-30T00:00:00Z","2018-07-07T00:00:00Z","2018-07-14T00:00:00Z","2018-07-21T00:00:00Z","2018-07-28T00:00:00Z","2018-08-04T00:00:00Z","2018-08-11T00:00:00Z","2018-08-18T00:00:00Z","2018-08-25T00:00:00Z","2018-09-01T00:00:00Z","2018-09-08T00:00:00Z","2018-09-15T00:00:00Z","2018-09-22T00:00:00Z","2018-09-29T00:00:00Z","2018-10-06T00:00:00Z","2018-10-13T00:00:00Z","2018-10-20T00:00:00Z","2018-10-27T00:00:00Z","2018-11-03T00:00:00Z","2018-11-10T00:00:00Z","2018-11-17T00:00:00Z","2018-11-24T00:00:00Z","2018-12-01T00:00:00Z","2018-12-08T00:00:00Z","2018-12-15T00:00:00Z","2018-12-22T00:00:00Z","2018-12-29T00:00:00Z","2019-01-05T00:00:00Z","2019-01-12T00:00:00Z","2019-01-19T00:00:00Z","2019-01-26T00:00:00Z","2019-02-02T00:00:00Z","2019-02-09T00:00:00Z","2019-02-16T00:00:00Z","2019-02-23T00:00:00Z","2019-03-02T00:00:00Z","2019-03-09T00:00:00Z","2019-03-16T00:00:00Z","2019-03-23T00:00:00Z","2019-03-30T00:00:00Z","2019-04-06T00:00:00Z","2019-04-13T00:00:00Z","2019-04-20T00:00:00Z","2019-04-27T00:00:00Z","2019-05-04T00:00:00Z","2019-05-11T00:00:00Z","2019-05-18T00:00:00Z","2019-05-25T00:00:00Z","2019-06-01T00:00:00Z","2019-06-08T00:00:00Z","2019-06-15T00:00:00Z","2019-06-22T00:00:00Z","2019-06-29T00:00:00Z","2019-07-06T00:00:00Z","2019-07-13T00:00:00Z","2019-07-20T00:00:00Z","2019-07-27T00:00:00Z","2019-08-03T00:00:00Z","2019-08-10T00:00:00Z","2019-08-17T00:00:00Z","2019-08-31T00:00:00Z","2019-09-07T00:00:00Z","2019-09-14T00:00:00Z","2019-09-21T00:00:00Z","2019-09-28T00:00:00Z","2019-10-05T00:00:00Z","2019-10-12T00:00:00Z","2019-10-19T00:00:00Z","2019-10-26T00:00:00Z","2019-11-02T00:00:00Z","2019-11-09T00:00:00Z","2019-11-16T00:00:00Z","2019-11-23T00:00:00Z","2019-11-30T00:00:00Z","2019-12-07T00:00:00Z","2019-12-14T00:00:00Z","2019-12-21T00:00:00Z","2019-12-28T00:00:00Z","2020-01-04T00:00:00Z","2020-01-11T00:00:00Z","2020-01-18T00:00:00Z","2020-01-25T00:00:00Z","2020-02-01T00:00:00Z","2020-02-08T00:00:00Z","2020-02-15T00:00:00Z","2020-02-22T00:00:00Z","2020-02-29T00:00:00Z","2020-03-07T00:00:00Z","2020-03-14T00:00:00Z"],[2705,2563,2292,2296,1918,2263,1861,1615,1771,1666,1573,1769,1444,1722,1441,1405,1199,1586,1666,1559,1913,1610,1632,1502,1483,1478,1884,1630,1381,1517,1530,1542,1429,1468,1578,1260,1331,1314,1472,2201,1377,1470,1590,1622,1868,1730,1663,2155,2232,2237,2830,3715,2616,2557,2104,1959,1971,1688,1595,1553,1651,1519,1434,1558,1358,1364,1546,1420,1147,1249,1392,1344,1468,1769,1455,1226,1177,1268,1800,1518,1193,1222,1216,1370,1195,1188,1797,1094,1104,1035,1098,1072,1364,1334,1254,1428,1563,1331,1573,1989,2355,2538,2810,2935,2085,2392,1603,1615,1564,1612,1324,1195,1476,1375,2419,1298,1146,1085,981,1045,990,1142,1088,1235,1320,1473,1311,1110,975,1090,2238,1446,1065,970,913,970,946,904,968,1845,929,826,896,1027,1006,985,1446,1036,1219,1747,2062,1988,1633,1393,2376,2647,1962,2195,1481,1338,1044,1422,1170,1077,1066,1092,1207,1603,1020,835,960,881,767,823,1109,1163,1254,1437,1242,947,927,825,1403,1665,815,729,707,786,866,805,712,700,618,878,728,1120,830,691,855,778,916,931,1279,1341,1974,1282,1770,1806,2295,1756,1456,1145,998,998,922,758,844,756,1418,761,782,684,680,654,774,721,660,889,892,1382,906,798,720,753,953,836,765,665,671,658,667,693,813,718,581,661,602,553,670,701,1143,700,826,796,1025,1483,1412,1665,1693,2147,1948,1778,1151,1049,1031,875,785,646,654,645,751,825,784,804,818,875,645,607,730,766,916,1034,1196,887,765,761,744,1029,768,655,648,736,746,682,713,640,704,630,634,655,777,673,653,613,717,796,909,1280,1069,1363,1188,1369,2792,1964,1355,1082,921,839,803,705,748,809,701,720,730,616,611,598,580,527,606,664,636,821,973,781,643,656,774,1010,611,545,568,564,693,568,546,525,827,552,514,551,1166,756,633,516,595,860,786,838,1309,1596,1282,1233,2211,1282,1245,1181,1115,1061,866,730,708,742,724,787,730,663,589,566,758,497,563,688,658,868,996,910,712,645,998,788,546,562,523,546,721,522,884,468,448,441,364,383,626,522,526,606,755,729,1147,997,1156,1089,1269,1815,1089,1036,913,916,796,653,527,476,496,498,763]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>week_ending_date<\/th>\n      <th>initial_claims<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatDate(data, \"toLocaleDateString\");\n  }"},{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
<p>Let’s just look at the most recent week, and that’s something that takes on different meaning when we’re talking about updating data. We need to make this generic so that every time we pull this up and run it, it’s the most recent week at the top. This time, it’s very simple.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="automating-analysis.html#cb361-1" aria-hidden="true" tabindex="-1"></a>weeklyclaims20 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(week_ending_date))</span></code></pre></div>
<pre><code>## # A tibble: 11 x 2
##    week_ending_date    initial_claims
##    &lt;dttm&gt;                       &lt;dbl&gt;
##  1 2020-03-14 00:00:00            763
##  2 2020-03-07 00:00:00            498
##  3 2020-02-29 00:00:00            496
##  4 2020-02-22 00:00:00            476
##  5 2020-02-15 00:00:00            527
##  6 2020-02-08 00:00:00            653
##  7 2020-02-01 00:00:00            796
##  8 2020-01-25 00:00:00            916
##  9 2020-01-18 00:00:00            913
## 10 2020-01-11 00:00:00           1036
## 11 2020-01-04 00:00:00           1089</code></pre>
</div>
<div id="analysis" class="section level2" number="22.3">
<h2><span class="header-section-number">22.3</span> Analysis</h2>
<p>Now is when we need to start asking ourselves – what are the questions that are going to come up week after week. What about how this most current week compares to all weeks going back to 2012? What if we just ranked them? Where does this week rank? For that, we’ll create a new column called Rank using mutate and we’ll use a function called <code>min_rank</code> to rank them. I’m going to save them to a dataframe and use data</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="automating-analysis.html#cb363-1" aria-hidden="true" tabindex="-1"></a>ranked <span class="ot">&lt;-</span> weeklyclaims <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(initial_claims))) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(week_ending_date)) </span>
<span id="cb363-2"><a href="automating-analysis.html#cb363-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-3"><a href="automating-analysis.html#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(ranked) <span class="sc">%&gt;%</span> <span class="fu">formatDate</span>(<span class="dv">1</span>, <span class="st">&quot;toLocaleDateString&quot;</span>) </span></code></pre></div>
<div id="htmlwidget-4946c8f7f916b9131ad2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4946c8f7f916b9131ad2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427"],["2020-03-14T00:00:00Z","2020-03-07T00:00:00Z","2020-02-29T00:00:00Z","2020-02-22T00:00:00Z","2020-02-15T00:00:00Z","2020-02-08T00:00:00Z","2020-02-01T00:00:00Z","2020-01-25T00:00:00Z","2020-01-18T00:00:00Z","2020-01-11T00:00:00Z","2020-01-04T00:00:00Z","2019-12-28T00:00:00Z","2019-12-21T00:00:00Z","2019-12-14T00:00:00Z","2019-12-07T00:00:00Z","2019-11-30T00:00:00Z","2019-11-23T00:00:00Z","2019-11-16T00:00:00Z","2019-11-09T00:00:00Z","2019-11-02T00:00:00Z","2019-10-26T00:00:00Z","2019-10-19T00:00:00Z","2019-10-12T00:00:00Z","2019-10-05T00:00:00Z","2019-09-28T00:00:00Z","2019-09-21T00:00:00Z","2019-09-14T00:00:00Z","2019-09-07T00:00:00Z","2019-08-31T00:00:00Z","2019-08-17T00:00:00Z","2019-08-10T00:00:00Z","2019-08-03T00:00:00Z","2019-07-27T00:00:00Z","2019-07-20T00:00:00Z","2019-07-13T00:00:00Z","2019-07-06T00:00:00Z","2019-06-29T00:00:00Z","2019-06-22T00:00:00Z","2019-06-15T00:00:00Z","2019-06-08T00:00:00Z","2019-06-01T00:00:00Z","2019-05-25T00:00:00Z","2019-05-18T00:00:00Z","2019-05-11T00:00:00Z","2019-05-04T00:00:00Z","2019-04-27T00:00:00Z","2019-04-20T00:00:00Z","2019-04-13T00:00:00Z","2019-04-06T00:00:00Z","2019-03-30T00:00:00Z","2019-03-23T00:00:00Z","2019-03-16T00:00:00Z","2019-03-09T00:00:00Z","2019-03-02T00:00:00Z","2019-02-23T00:00:00Z","2019-02-16T00:00:00Z","2019-02-09T00:00:00Z","2019-02-02T00:00:00Z","2019-01-26T00:00:00Z","2019-01-19T00:00:00Z","2019-01-12T00:00:00Z","2019-01-05T00:00:00Z","2018-12-29T00:00:00Z","2018-12-22T00:00:00Z","2018-12-15T00:00:00Z","2018-12-08T00:00:00Z","2018-12-01T00:00:00Z","2018-11-24T00:00:00Z","2018-11-17T00:00:00Z","2018-11-10T00:00:00Z","2018-11-03T00:00:00Z","2018-10-27T00:00:00Z","2018-10-20T00:00:00Z","2018-10-13T00:00:00Z","2018-10-06T00:00:00Z","2018-09-29T00:00:00Z","2018-09-22T00:00:00Z","2018-09-15T00:00:00Z","2018-09-08T00:00:00Z","2018-09-01T00:00:00Z","2018-08-25T00:00:00Z","2018-08-18T00:00:00Z","2018-08-11T00:00:00Z","2018-08-04T00:00:00Z","2018-07-28T00:00:00Z","2018-07-21T00:00:00Z","2018-07-14T00:00:00Z","2018-07-07T00:00:00Z","2018-06-30T00:00:00Z","2018-06-23T00:00:00Z","2018-06-16T00:00:00Z","2018-06-09T00:00:00Z","2018-06-02T00:00:00Z","2018-05-26T00:00:00Z","2018-05-19T00:00:00Z","2018-05-12T00:00:00Z","2018-05-05T00:00:00Z","2018-04-28T00:00:00Z","2018-04-21T00:00:00Z","2018-04-14T00:00:00Z","2018-04-07T00:00:00Z","2018-03-31T00:00:00Z","2018-03-24T00:00:00Z","2018-03-17T00:00:00Z","2018-03-10T00:00:00Z","2018-03-03T00:00:00Z","2018-02-24T00:00:00Z","2018-02-17T00:00:00Z","2018-02-10T00:00:00Z","2018-02-03T00:00:00Z","2018-01-27T00:00:00Z","2018-01-20T00:00:00Z","2018-01-13T00:00:00Z","2018-01-06T00:00:00Z","2017-12-30T00:00:00Z","2017-12-23T00:00:00Z","2017-12-16T00:00:00Z","2017-12-09T00:00:00Z","2017-12-02T00:00:00Z","2017-11-25T00:00:00Z","2017-11-18T00:00:00Z","2017-11-11T00:00:00Z","2017-11-04T00:00:00Z","2017-10-28T00:00:00Z","2017-10-21T00:00:00Z","2017-10-14T00:00:00Z","2017-10-07T00:00:00Z","2017-09-30T00:00:00Z","2017-09-23T00:00:00Z","2017-09-16T00:00:00Z","2017-09-09T00:00:00Z","2017-09-02T00:00:00Z","2017-08-26T00:00:00Z","2017-08-19T00:00:00Z","2017-08-12T00:00:00Z","2017-08-05T00:00:00Z","2017-07-29T00:00:00Z","2017-07-22T00:00:00Z","2017-07-15T00:00:00Z","2017-07-08T00:00:00Z","2017-07-01T00:00:00Z","2017-06-24T00:00:00Z","2017-06-17T00:00:00Z","2017-06-10T00:00:00Z","2017-06-03T00:00:00Z","2017-05-27T00:00:00Z","2017-05-20T00:00:00Z","2017-05-13T00:00:00Z","2017-05-06T00:00:00Z","2017-04-29T00:00:00Z","2017-04-22T00:00:00Z","2017-04-15T00:00:00Z","2017-04-08T00:00:00Z","2017-04-01T00:00:00Z","2017-03-25T00:00:00Z","2017-03-18T00:00:00Z","2017-03-11T00:00:00Z","2017-03-04T00:00:00Z","2017-02-25T00:00:00Z","2017-02-18T00:00:00Z","2017-02-11T00:00:00Z","2017-02-04T00:00:00Z","2017-01-28T00:00:00Z","2017-01-21T00:00:00Z","2017-01-14T00:00:00Z","2017-01-07T00:00:00Z","2016-12-31T00:00:00Z","2016-12-24T00:00:00Z","2016-12-17T00:00:00Z","2016-12-10T00:00:00Z","2016-12-03T00:00:00Z","2016-11-26T00:00:00Z","2016-11-19T00:00:00Z","2016-11-12T00:00:00Z","2016-11-05T00:00:00Z","2016-10-29T00:00:00Z","2016-10-22T00:00:00Z","2016-10-15T00:00:00Z","2016-10-08T00:00:00Z","2016-10-01T00:00:00Z","2016-09-24T00:00:00Z","2016-09-17T00:00:00Z","2016-09-10T00:00:00Z","2016-09-03T00:00:00Z","2016-08-27T00:00:00Z","2016-08-20T00:00:00Z","2016-08-13T00:00:00Z","2016-08-06T00:00:00Z","2016-07-30T00:00:00Z","2016-07-23T00:00:00Z","2016-07-16T00:00:00Z","2016-07-09T00:00:00Z","2016-07-02T00:00:00Z","2016-06-25T00:00:00Z","2016-06-18T00:00:00Z","2016-06-11T00:00:00Z","2016-06-04T00:00:00Z","2016-05-28T00:00:00Z","2016-05-21T00:00:00Z","2016-05-14T00:00:00Z","2016-05-07T00:00:00Z","2016-04-30T00:00:00Z","2016-04-23T00:00:00Z","2016-04-16T00:00:00Z","2016-04-09T00:00:00Z","2016-04-02T00:00:00Z","2016-03-26T00:00:00Z","2016-03-19T00:00:00Z","2016-03-12T00:00:00Z","2016-03-05T00:00:00Z","2016-02-27T00:00:00Z","2016-02-20T00:00:00Z","2016-02-13T00:00:00Z","2016-02-06T00:00:00Z","2016-01-30T00:00:00Z","2016-01-23T00:00:00Z","2016-01-16T00:00:00Z","2016-01-09T00:00:00Z","2016-01-02T00:00:00Z","2015-12-26T00:00:00Z","2015-12-19T00:00:00Z","2015-12-12T00:00:00Z","2015-12-05T00:00:00Z","2015-11-28T00:00:00Z","2015-11-21T00:00:00Z","2015-11-14T00:00:00Z","2015-11-07T00:00:00Z","2015-10-31T00:00:00Z","2015-10-24T00:00:00Z","2015-10-17T00:00:00Z","2015-10-10T00:00:00Z","2015-10-03T00:00:00Z","2015-09-26T00:00:00Z","2015-09-19T00:00:00Z","2015-09-12T00:00:00Z","2015-09-05T00:00:00Z","2015-08-29T00:00:00Z","2015-08-22T00:00:00Z","2015-08-15T00:00:00Z","2015-08-08T00:00:00Z","2015-08-01T00:00:00Z","2015-07-25T00:00:00Z","2015-07-18T00:00:00Z","2015-07-11T00:00:00Z","2015-07-04T00:00:00Z","2015-06-27T00:00:00Z","2015-06-20T00:00:00Z","2015-06-13T00:00:00Z","2015-06-06T00:00:00Z","2015-05-30T00:00:00Z","2015-05-23T00:00:00Z","2015-05-16T00:00:00Z","2015-05-09T00:00:00Z","2015-05-02T00:00:00Z","2015-04-25T00:00:00Z","2015-04-18T00:00:00Z","2015-04-11T00:00:00Z","2015-04-04T00:00:00Z","2015-03-21T00:00:00Z","2015-03-14T00:00:00Z","2015-03-07T00:00:00Z","2015-02-28T00:00:00Z","2015-02-21T00:00:00Z","2015-02-14T00:00:00Z","2015-02-07T00:00:00Z","2015-01-31T00:00:00Z","2015-01-24T00:00:00Z","2015-01-17T00:00:00Z","2015-01-10T00:00:00Z","2015-01-03T00:00:00Z","2014-12-27T00:00:00Z","2014-12-20T00:00:00Z","2014-12-13T00:00:00Z","2014-12-06T00:00:00Z","2014-11-29T00:00:00Z","2014-11-22T00:00:00Z","2014-11-15T00:00:00Z","2014-11-08T00:00:00Z","2014-11-01T00:00:00Z","2014-10-25T00:00:00Z","2014-10-18T00:00:00Z","2014-10-11T00:00:00Z","2014-10-04T00:00:00Z","2014-09-27T00:00:00Z","2014-09-20T00:00:00Z","2014-09-13T00:00:00Z","2014-09-06T00:00:00Z","2014-08-30T00:00:00Z","2014-08-23T00:00:00Z","2014-08-16T00:00:00Z","2014-08-09T00:00:00Z","2014-08-02T00:00:00Z","2014-07-26T00:00:00Z","2014-07-19T00:00:00Z","2014-07-12T00:00:00Z","2014-07-05T00:00:00Z","2014-06-28T00:00:00Z","2014-06-21T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-05-31T00:00:00Z","2014-05-24T00:00:00Z","2014-05-17T00:00:00Z","2014-05-10T00:00:00Z","2014-05-03T00:00:00Z","2014-04-26T00:00:00Z","2014-04-19T00:00:00Z","2014-04-12T00:00:00Z","2014-04-05T00:00:00Z","2014-03-29T00:00:00Z","2014-03-28T00:00:00Z","2014-03-22T00:00:00Z","2014-03-15T00:00:00Z","2014-03-08T00:00:00Z","2014-03-01T00:00:00Z","2014-02-22T00:00:00Z","2014-02-15T00:00:00Z","2014-02-08T00:00:00Z","2014-02-01T00:00:00Z","2014-01-25T00:00:00Z","2014-01-18T00:00:00Z","2014-01-11T00:00:00Z","2014-01-04T00:00:00Z","2013-12-28T00:00:00Z","2013-12-21T00:00:00Z","2013-12-14T00:00:00Z","2013-12-07T00:00:00Z","2013-11-30T00:00:00Z","2013-11-23T00:00:00Z","2013-11-16T00:00:00Z","2013-11-09T00:00:00Z","2013-11-02T00:00:00Z","2013-10-26T00:00:00Z","2013-10-19T00:00:00Z","2013-10-12T00:00:00Z","2013-10-05T00:00:00Z","2013-09-28T00:00:00Z","2013-09-21T00:00:00Z","2013-09-14T00:00:00Z","2013-09-07T00:00:00Z","2013-08-31T00:00:00Z","2013-08-24T00:00:00Z","2013-08-17T00:00:00Z","2013-08-10T00:00:00Z","2013-08-03T00:00:00Z","2013-07-27T00:00:00Z","2013-07-20T00:00:00Z","2013-07-13T00:00:00Z","2013-07-06T00:00:00Z","2013-06-29T00:00:00Z","2013-06-22T00:00:00Z","2013-06-15T00:00:00Z","2013-06-08T00:00:00Z","2013-06-01T00:00:00Z","2013-05-25T00:00:00Z","2013-05-18T00:00:00Z","2013-05-11T00:00:00Z","2013-05-04T00:00:00Z","2013-04-27T00:00:00Z","2013-04-20T00:00:00Z","2013-04-13T00:00:00Z","2013-04-06T00:00:00Z","2013-03-30T00:00:00Z","2013-03-23T00:00:00Z","2013-03-16T00:00:00Z","2013-03-09T00:00:00Z","2013-03-02T00:00:00Z","2013-02-23T00:00:00Z","2013-02-16T00:00:00Z","2013-02-09T00:00:00Z","2013-02-02T00:00:00Z","2013-01-26T00:00:00Z","2013-01-19T00:00:00Z","2013-01-12T00:00:00Z","2013-01-05T00:00:00Z","2012-12-29T00:00:00Z","2012-12-22T00:00:00Z","2012-12-15T00:00:00Z","2012-12-08T00:00:00Z","2012-12-01T00:00:00Z","2012-11-24T00:00:00Z","2012-11-17T00:00:00Z","2012-11-10T00:00:00Z","2012-11-03T00:00:00Z","2012-10-27T00:00:00Z","2012-10-20T00:00:00Z","2012-10-13T00:00:00Z","2012-10-06T00:00:00Z","2012-09-29T00:00:00Z","2012-09-22T00:00:00Z","2012-09-15T00:00:00Z","2012-09-08T00:00:00Z","2012-09-01T00:00:00Z","2012-08-25T00:00:00Z","2012-08-18T00:00:00Z","2012-08-11T00:00:00Z","2012-08-04T00:00:00Z","2012-07-28T00:00:00Z","2012-07-21T00:00:00Z","2012-07-14T00:00:00Z","2012-07-07T00:00:00Z","2012-06-30T00:00:00Z","2012-06-23T00:00:00Z","2012-06-16T00:00:00Z","2012-06-09T00:00:00Z","2012-06-02T00:00:00Z","2012-05-26T00:00:00Z","2012-05-19T00:00:00Z","2012-05-12T00:00:00Z","2012-05-05T00:00:00Z","2012-04-28T00:00:00Z","2012-04-21T00:00:00Z","2012-04-14T00:00:00Z","2012-04-07T00:00:00Z","2012-03-31T00:00:00Z","2012-03-24T00:00:00Z","2012-03-17T00:00:00Z","2012-03-10T00:00:00Z","2012-03-03T00:00:00Z","2012-02-25T00:00:00Z","2012-02-18T00:00:00Z","2012-02-11T00:00:00Z","2012-02-04T00:00:00Z","2012-01-28T00:00:00Z","2012-01-21T00:00:00Z","2012-01-14T00:00:00Z","2012-01-07T00:00:00Z"],[763,498,496,476,527,653,796,916,913,1036,1089,1815,1269,1089,1156,997,1147,729,755,606,526,522,626,383,364,441,448,468,884,522,721,546,523,562,546,788,998,645,712,910,996,868,658,688,563,497,758,566,589,663,730,787,724,742,708,730,866,1061,1115,1181,1245,1282,2211,1233,1282,1596,1309,838,786,860,595,516,633,756,1166,551,514,552,827,525,546,568,693,564,568,545,611,1010,774,656,643,781,973,821,636,664,606,527,580,598,611,616,730,720,701,809,748,705,803,839,921,1082,1355,1964,2792,1369,1188,1363,1069,1280,909,796,717,613,653,673,777,655,634,630,704,640,713,682,746,736,648,655,768,1029,744,761,765,887,1196,1034,916,766,730,607,645,875,818,804,784,825,751,645,654,646,785,875,1031,1049,1151,1778,1948,2147,1693,1665,1412,1483,1025,796,826,700,1143,701,670,553,602,661,581,718,813,693,667,658,671,665,765,836,953,753,720,798,906,1382,892,889,660,721,774,654,680,684,782,761,1418,756,844,758,922,998,998,1145,1456,1756,2295,1806,1770,1282,1974,1341,1279,931,916,778,855,691,830,1120,728,878,618,700,712,805,866,786,707,729,815,1665,1403,825,927,947,1242,1437,1254,1163,1109,823,767,881,960,835,1603,1207,1092,1066,1077,1170,1422,1044,1338,1481,2195,1962,2647,2376,1393,1633,1988,2062,1747,1219,1036,1446,985,1006,1027,896,826,929,1845,968,904,946,970,913,970,1065,1446,2238,1090,975,1110,1311,1473,1320,1235,1088,1142,990,1045,981,1085,1146,1020,1298,2419,1375,1476,1195,1324,1612,1564,1615,1603,2392,2085,2935,2810,2538,2355,1989,1573,1331,1563,1428,1254,1334,1364,1072,1098,1035,1104,1094,1797,1188,1195,1370,1216,1222,1193,1518,1800,1268,1177,1226,1455,1769,1468,1344,1392,1249,1147,1420,1546,1364,1358,1558,1434,1519,1651,1553,1595,1688,1971,1959,2104,2557,2616,3715,2830,2237,2232,2155,1663,1730,1868,1622,1590,1470,1377,2201,1472,1314,1331,1260,1578,1468,1429,1542,1530,1517,1381,1630,1884,1478,1483,1502,1632,1610,1913,1559,1666,1586,1199,1405,1441,1722,1444,1769,1573,1666,1771,1615,1861,2263,1918,2296,2292,2563,2705],[306,419,421,422,410,369,286,242,245,209,195,45,151,195,178,223,180,325,313,389,412,415,382,426,427,425,424,423,255,415,329,406,414,402,406,289,220,373,336,247,224,260,362,349,401,420,309,399,394,359,321,290,328,319,338,321,261,205,187,173,157,146,23,160,146,76,144,267,291,263,393,417,380,311,176,405,418,404,271,413,406,397,346,400,397,409,386,218,299,364,376,296,229,277,378,358,389,410,396,392,386,384,321,331,342,281,316,340,284,266,241,199,133,35,5,128,171,131,202,149,248,286,334,385,369,353,298,365,379,381,341,377,335,351,317,320,371,365,301,214,318,307,304,254,167,212,242,303,321,388,373,258,278,283,294,274,315,373,367,372,293,258,213,206,179,49,38,27,58,62,118,95,216,286,272,344,184,342,355,403,391,360,395,333,280,346,356,362,354,357,304,268,234,314,331,285,249,123,252,253,361,329,299,367,352,350,295,307,117,311,265,309,240,220,220,183,105,54,17,46,51,146,33,135,150,237,242,297,264,348,270,186,327,257,383,344,336,282,261,291,339,325,279,62,120,274,239,235,158,111,154,177,189,276,302,256,233,269,74,165,193,203,200,175,115,208,136,97,25,36,7,14,121,66,32,30,55,163,209,107,226,219,215,251,272,238,44,232,250,236,230,245,230,204,107,20,194,228,188,143,100,141,159,197,185,225,207,227,198,182,217,145,12,126,99,168,140,72,83,70,74,13,29,2,4,11,15,31,81,138,84,114,154,137,129,201,191,211,190,192,48,171,168,127,164,162,170,92,47,152,174,161,106,52,103,134,122,156,180,116,88,129,132,86,112,91,65,87,77,59,34,37,28,10,8,1,3,21,22,26,64,56,42,69,78,102,125,24,101,142,138,153,80,103,113,89,90,93,124,68,41,98,95,94,67,73,40,85,60,79,166,119,110,57,109,52,81,60,50,70,43,19,39,16,18,9,6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>week_ending_date<\/th>\n      <th>initial_claims<\/th>\n      <th>Rank<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatDate(data, \"toLocaleDateString\");\n  }"},{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
<p>Let’s think about this a little more. What else could we do with this. What are the recurring questions? How about the percent change between this week and last week?</p>
<p>To do that, we need our dates to be next to each other – side by side. Then we can do new minus old divided by old. To do that, we’re going to use a function from <code>tidyr</code> called pivot_wider, which will transform our data from one row per week to one row, with the weeks as columns.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="automating-analysis.html#cb364-1" aria-hidden="true" tabindex="-1"></a>change <span class="ot">&lt;-</span> weeklyclaims20 <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> week_ending_date, <span class="at">values_from =</span> initial_claims)</span>
<span id="cb364-2"><a href="automating-analysis.html#cb364-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-3"><a href="automating-analysis.html#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(change)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   `2020-01-04` `2020-01-11` `2020-01-18` `2020-01-25` `2020-02-01` `2020-02-08`
##          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1         1089         1036          913          916          796          653
## # … with 5 more variables: 2020-02-15 &lt;dbl&gt;, 2020-02-22 &lt;dbl&gt;,
## #   2020-02-29 &lt;dbl&gt;, 2020-03-07 &lt;dbl&gt;, 2020-03-14 &lt;dbl&gt;</code></pre>
<p>Now the problem we have is … which column is the last one, and which one is the previous one? I’ll be honest, this isn’t easy in R. But the trick is to reverse the order of the columns. Then, your newest one is column 1 and the next newest is 2.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="automating-analysis.html#cb366-1" aria-hidden="true" tabindex="-1"></a>changecalc <span class="ot">&lt;-</span> ((<span class="fu">rev</span>(change)[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">rev</span>(change)[<span class="dv">2</span>])<span class="sc">/</span><span class="fu">rev</span>(change)[<span class="dv">2</span>])<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb366-2"><a href="automating-analysis.html#cb366-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-3"><a href="automating-analysis.html#cb366-3" aria-hidden="true" tabindex="-1"></a>changecalc</span></code></pre></div>
<pre><code>##   2020-03-14
## 1   53.21285</code></pre>
<p>So whatever the date, that’ll always return the percent change between the most recent date and the previous week.</p>
</div>
<div id="making-updating-graphics" class="section level2" number="22.4">
<h2><span class="header-section-number">22.4</span> Making updating graphics</h2>
<p>More than numbers, we are going to want to see this data. We can build this in steps. First, let’s just make a big bar chart.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="automating-analysis.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb368-2"><a href="automating-analysis.html#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data=</span>ranked, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">weight=</span>initial_claims)) </span></code></pre></div>
<p><img src="datajournalism_files/figure-html/unnamed-chunk-237-1.png" width="864" /></p>
<p>So that shows us that the trend is going down over time, and that there’s some regular spikes around the holidays. Which tells us this data is seasonal, but we knew that going in.</p>
<p>Let’s build up some more layers to highlight trends and the most recent spot.</p>
<p>First, we’ll slice out a dataframe that’s just the most recent data.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="automating-analysis.html#cb369-1" aria-hidden="true" tabindex="-1"></a>latest <span class="ot">&lt;-</span> ranked <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Now, in ggplot, we can add multiple layers.</p>
<p>The first layer will be all the bars.</p>
<p>The second layer will just be the latest.</p>
<p>Then we’ll add a point to the top of that line to really draw attention to it.</p>
<p>Then we’ll use ggprepel to label it.</p>
<p>Then I’m going to add a smoothing line. That’ll illustrate the trend clearly.</p>
<p>The rest is labeling and adjusting the text to make it look more like a news graphic.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="automating-analysis.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb370-2"><a href="automating-analysis.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data=</span>ranked, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">weight=</span>initial_claims)) <span class="sc">+</span></span>
<span id="cb370-3"><a href="automating-analysis.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data=</span>latest, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">weight=</span>initial_claims), <span class="at">fill=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb370-4"><a href="automating-analysis.html#cb370-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>latest, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">y=</span>initial_claims)) <span class="sc">+</span> </span>
<span id="cb370-5"><a href="automating-analysis.html#cb370-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>latest, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">y=</span>initial_claims <span class="sc">+</span> <span class="dv">150</span>, <span class="at">label=</span><span class="st">&quot;This week&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb370-6"><a href="automating-analysis.html#cb370-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data=</span>ranked, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">y=</span>initial_claims), <span class="at">method=</span>loess, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb370-7"><a href="automating-analysis.html#cb370-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Nebraska jobless claims on the rise&quot;</span>, <span class="at">x=</span><span class="st">&quot;Date&quot;</span>, <span class="at">y=</span><span class="st">&quot;Claims&quot;</span>) <span class="sc">+</span></span>
<span id="cb370-8"><a href="automating-analysis.html#cb370-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb370-9"><a href="automating-analysis.html#cb370-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb370-10"><a href="automating-analysis.html#cb370-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb370-11"><a href="automating-analysis.html#cb370-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb370-12"><a href="automating-analysis.html#cb370-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb370-13"><a href="automating-analysis.html#cb370-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb370-14"><a href="automating-analysis.html#cb370-14" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="datajournalism_files/figure-html/unnamed-chunk-239-1.png" width="864" /></p>
<p>One thing we are missing? Context. What if we programmatically wrote the chatter for this chart using the percent change calculation we did before?</p>
<p>First, we format the change to look more news graphic like and not with 7 significant digits.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="automating-analysis.html#cb372-1" aria-hidden="true" tabindex="-1"></a>changetext <span class="ot">&lt;-</span> <span class="fu">round</span>(changecalc[[<span class="dv">1</span>]], <span class="at">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Now we’re going to use a function called paste to merge some text together. We’re going to paste together a sentence fragment, the percent change number and another sentence fragment together to form a sentence. We’ll save it as sub, because that’s what it’s called in ggplot – a subtitle.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="automating-analysis.html#cb373-1" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;First time unemployment claims rose by &quot;</span>, changetext, <span class="st">&quot; percent over last week&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Here’s our sentence:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="automating-analysis.html#cb374-1" aria-hidden="true" tabindex="-1"></a>sub</span></code></pre></div>
<pre><code>## [1] &quot;First time unemployment claims rose by 53.21 percent over last week&quot;</code></pre>
<p>Now we can add that to our labels.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="automating-analysis.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb376-2"><a href="automating-analysis.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data=</span>ranked, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">weight=</span>initial_claims)) <span class="sc">+</span></span>
<span id="cb376-3"><a href="automating-analysis.html#cb376-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">data=</span>latest, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">weight=</span>initial_claims), <span class="at">fill=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb376-4"><a href="automating-analysis.html#cb376-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>latest, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">y=</span>initial_claims)) <span class="sc">+</span> </span>
<span id="cb376-5"><a href="automating-analysis.html#cb376-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>latest, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">y=</span>initial_claims <span class="sc">+</span> <span class="dv">150</span>, <span class="at">label=</span><span class="st">&quot;This week&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb376-6"><a href="automating-analysis.html#cb376-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data=</span>ranked, <span class="fu">aes</span>(<span class="at">x=</span>week_ending_date, <span class="at">y=</span>initial_claims), <span class="at">method=</span>loess, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb376-7"><a href="automating-analysis.html#cb376-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Nebraska jobless claims on the rise&quot;</span>, <span class="at">subtitle=</span>sub, <span class="at">x=</span><span class="st">&quot;Date&quot;</span>, <span class="at">y=</span><span class="st">&quot;Claims&quot;</span>) <span class="sc">+</span></span>
<span id="cb376-8"><a href="automating-analysis.html#cb376-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb376-9"><a href="automating-analysis.html#cb376-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb376-10"><a href="automating-analysis.html#cb376-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb376-11"><a href="automating-analysis.html#cb376-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb376-12"><a href="automating-analysis.html#cb376-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb376-13"><a href="automating-analysis.html#cb376-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb376-14"><a href="automating-analysis.html#cb376-14" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="datajournalism_files/figure-html/unnamed-chunk-243-1.png" width="864" /></p>
<p>This is going to be a story for months, if not years. So repeating this analysis is a must for a reporter covering the economy in Nebraska. We’ve set ourselves up to do this every week when the data comes out. We just open our notebook, go to Run &gt; Restart R and Run All Chunks and sit back and watch as it does it all again.</p>
<p>Then we go report.</p>
</div>
<div id="the-state-vs-the-feds" class="section level2" number="22.5">
<h2><span class="header-section-number">22.5</span> The State vs the Feds</h2>
<p>As I write this, the state hasn’t updated their data but the feds have, and the feds have more. The problem? It’s a mess. And it’s not automatable. So to get more data, you need to go to <a href="https://oui.doleta.gov/unemploy/claims.asp">the Department of Labor website</a> and fill out the form.</p>
<p>Leave the years, select state, pick yours (I’m taking Nebraska) and select spreadsheet, but know that it’s a lie. If you try to load it using read_excel, you’ll get an error. Why? Because what is being downloaded is an HTML file. So you can use <code>rvest</code> to read and parse it.</p>
<p>However, that isn’t so simple.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="automating-analysis.html#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb378-2"><a href="automating-analysis.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p>First, read the file you downloaded. You’ll need to add the <code>fill=TRUE</code> to html_table() to solve a problem with some of the data.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="automating-analysis.html#cb379-1" aria-hidden="true" tabindex="-1"></a>claims <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;~/Downloads/r539cy.xls&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb379-2"><a href="automating-analysis.html#cb379-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb379-3"><a href="automating-analysis.html#cb379-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>(<span class="at">fill=</span><span class="cn">TRUE</span>) </span></code></pre></div>
<pre><code>## Error: &#39;~/Downloads/r539cy.xls&#39; does not exist.</code></pre>
<p>Similar to previous efforts, we get a list. The first element is a dataframe, so let’s get that.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="automating-analysis.html#cb381-1" aria-hidden="true" tabindex="-1"></a>claims <span class="ot">&lt;-</span> claims[[<span class="dv">1</span>]] </span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;claims&#39; not found</code></pre>
<p>Now if you look at this data, you’ll see that the header row is empty, and the header names are in the first row. Also, none of this data is formatted correctly. We need to fix that.</p>
<p>To do this, we’re going to fix this in steps after we create a new dataframe called <code>cleanclaims</code></p>
<ol style="list-style-type: decimal">
<li>We’ll remove empty columns.</li>
<li>We’ll rename the columns with what they are, using <code>janitor</code> style naming conventions.</li>
<li>We’ll filter out the old header row.</li>
<li>We’ll mutate each field to format them correctly. The date columns will use <code>lubridate</code>’s <code>mdy</code> function. Numbers will use <code>readr</code>’s <code>parse_number</code> function to solve the comma separator issue.</li>
</ol>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="automating-analysis.html#cb383-1" aria-hidden="true" tabindex="-1"></a>cleanclaims <span class="ot">&lt;-</span> claims <span class="sc">%&gt;%</span> </span>
<span id="cb383-2"><a href="automating-analysis.html#cb383-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_empty</span>(<span class="st">&quot;cols&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb383-3"><a href="automating-analysis.html#cb383-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;state&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;filed_week_ended&quot;</span><span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;initial_claims&quot;</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">&quot;reflecting_week_ended&quot;</span><span class="ot">=</span><span class="dv">4</span>, <span class="st">&quot;continued_claims&quot;</span><span class="ot">=</span><span class="dv">5</span>, <span class="st">&quot;covered_employment&quot;</span><span class="ot">=</span><span class="dv">6</span>, <span class="st">&quot;insured_unemployment_rate&quot;</span><span class="ot">=</span><span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb383-4"><a href="automating-analysis.html#cb383-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">&quot;State&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb383-5"><a href="automating-analysis.html#cb383-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">filed_week_ended =</span> <span class="fu">mdy</span>(filed_week_ended), <span class="at">initial_claims=</span><span class="fu">parse_number</span>(initial_claims), <span class="at">reflecting_week_ended=</span><span class="fu">mdy</span>(reflecting_week_ended), <span class="at">continued_claims=</span><span class="fu">parse_number</span>(continued_claims), <span class="at">covered_employment=</span><span class="fu">parse_number</span>(covered_employment), <span class="at">insured_unemployment_rate=</span><span class="fu">parse_number</span>(insured_unemployment_rate))</span></code></pre></div>
<pre><code>## Error in is.data.frame(x): object &#39;claims&#39; not found</code></pre>
<p>If you open <code>cleanclaims</code>, you may notice something:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="automating-analysis.html#cb385-1" aria-hidden="true" tabindex="-1"></a>cleanclaims <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(filed_week_ended)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Error in arrange(., desc(filed_week_ended)): object &#39;cleanclaims&#39; not found</code></pre>
<p>See it? The latest data isn’t in there in my version. <a href="https://www.dol.gov/sites/dolgov/files/OPA/newsreleases/ui-claims/20200551.pdf">It’s in a press release</a>.</p>
<p>So how do we add it? We use <code>add_row</code> from the tidyverse (specifically the <code>tibble</code> library).</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="automating-analysis.html#cb387-1" aria-hidden="true" tabindex="-1"></a>updatedcleanclaims <span class="ot">&lt;-</span> cleanclaims <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">state=</span><span class="st">&quot;Nebraska&quot;</span>, <span class="at">filed_week_ended=</span><span class="fu">as.Date</span>(<span class="st">&quot;2020-03-28&quot;</span>), <span class="at">initial_claims=</span><span class="dv">24572</span>, <span class="at">reflecting_week_ended=</span><span class="fu">as.Date</span>(<span class="st">&quot;2020-03-21&quot;</span>))</span></code></pre></div>
<pre><code>## Error in add_row(., state = &quot;Nebraska&quot;, filed_week_ended = as.Date(&quot;2020-03-28&quot;), : object &#39;cleanclaims&#39; not found</code></pre>
<p>Now we can repeat the analysis from above.</p>
<p>First we rank.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="automating-analysis.html#cb389-1" aria-hidden="true" tabindex="-1"></a>fedranked <span class="ot">&lt;-</span> updatedcleanclaims <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Rank =</span> <span class="fu">min_rank</span>(<span class="fu">desc</span>(initial_claims))) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(filed_week_ended))</span></code></pre></div>
<pre><code>## Error in mutate(., Rank = min_rank(desc(initial_claims))): object &#39;updatedcleanclaims&#39; not found</code></pre>
<p>We get the latest week.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="automating-analysis.html#cb391-1" aria-hidden="true" tabindex="-1"></a>fedlatest <span class="ot">&lt;-</span> fedranked <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Error in slice(., 1): object &#39;fedranked&#39; not found</code></pre>
<p>The previous week …</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="automating-analysis.html#cb393-1" aria-hidden="true" tabindex="-1"></a>fedprevious <span class="ot">&lt;-</span> fedranked <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Error in slice(., 2): object &#39;fedranked&#39; not found</code></pre>
<p>And for this one, let’s grab the pre-crisis number as well as a basis point.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="automating-analysis.html#cb395-1" aria-hidden="true" tabindex="-1"></a>pre <span class="ot">&lt;-</span> fedranked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(filed_week_ended<span class="sc">==</span><span class="fu">as.Date</span>(<span class="st">&quot;2020-03-14&quot;</span>))</span></code></pre></div>
<pre><code>## Error in filter(., filed_week_ended == as.Date(&quot;2020-03-14&quot;)): object &#39;fedranked&#39; not found</code></pre>
<p>Now we can do some percent change math similar to above. First we calculate the current change.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="automating-analysis.html#cb397-1" aria-hidden="true" tabindex="-1"></a>change <span class="ot">&lt;-</span> <span class="fu">round</span>((((fedlatest<span class="sc">$</span>initial_claims <span class="sc">-</span> fedprevious<span class="sc">$</span>initial_claims)<span class="sc">/</span>fedprevious<span class="sc">$</span>initial_claims)<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;fedlatest&#39; not found</code></pre>
<p>Then the change from the pre-crisis week.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="automating-analysis.html#cb399-1" aria-hidden="true" tabindex="-1"></a>prechange <span class="ot">&lt;-</span> <span class="fu">round</span>((((fedlatest<span class="sc">$</span>initial_claims <span class="sc">-</span> pre<span class="sc">$</span>initial_claims)<span class="sc">/</span>pre<span class="sc">$</span>initial_claims)<span class="sc">*</span><span class="dv">100</span>), <span class="at">digits=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;fedlatest&#39; not found</code></pre>
<p>And we roll it all into a subhead that we can use in the chart with a little paste-fu.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="automating-analysis.html#cb401-1" aria-hidden="true" tabindex="-1"></a>subhed <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Applications for unemployment jumped &quot;</span>, change, <span class="st">&quot; percent from last week to this week and are up &quot;</span>, prechange, <span class="st">&quot; percent since March 14.&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## Error in paste(&quot;Applications for unemployment jumped &quot;, change, &quot; percent from last week to this week and are up &quot;, : object &#39;prechange&#39; not found</code></pre>
<p>And we make the graphic.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="automating-analysis.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb403-2"><a href="automating-analysis.html#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>fedranked, <span class="fu">aes</span>(<span class="at">x=</span>filed_week_ended, <span class="at">y=</span>initial_claims, <span class="at">group=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb403-3"><a href="automating-analysis.html#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>fedlatest, <span class="fu">aes</span>(<span class="at">x=</span>filed_week_ended, <span class="at">y=</span>initial_claims)) <span class="sc">+</span> </span>
<span id="cb403-4"><a href="automating-analysis.html#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>fedlatest, <span class="fu">aes</span>(<span class="at">x=</span>filed_week_ended<span class="dv">-500</span>, <span class="at">y=</span>initial_claims <span class="sc">+</span> <span class="dv">500</span>, <span class="at">label=</span>initial_claims)) <span class="sc">+</span> </span>
<span id="cb403-5"><a href="automating-analysis.html#cb403-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>fedprevious, <span class="fu">aes</span>(<span class="at">x=</span>filed_week_ended, <span class="at">y=</span>initial_claims)) <span class="sc">+</span> </span>
<span id="cb403-6"><a href="automating-analysis.html#cb403-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>fedprevious, <span class="fu">aes</span>(<span class="at">x=</span>filed_week_ended<span class="dv">-500</span>, <span class="at">y=</span>initial_claims <span class="sc">+</span> <span class="dv">500</span>, <span class="at">label=</span>initial_claims)) <span class="sc">+</span> </span>
<span id="cb403-7"><a href="automating-analysis.html#cb403-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data=</span>fedranked, <span class="fu">aes</span>(<span class="at">x=</span>filed_week_ended, <span class="at">y=</span>initial_claims), <span class="at">method=</span>loess, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb403-8"><a href="automating-analysis.html#cb403-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Another record for jobless claims in Nebraska&quot;</span>, <span class="at">subtitle=</span>subhed, <span class="at">x=</span><span class="st">&quot;Date&quot;</span>, <span class="at">y=</span><span class="st">&quot;Claims&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Source: US Dept. of Labor  |  Graphic by Matt Waite&quot;</span>) <span class="sc">+</span></span>
<span id="cb403-9"><a href="automating-analysis.html#cb403-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb403-10"><a href="automating-analysis.html#cb403-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb403-11"><a href="automating-analysis.html#cb403-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb403-12"><a href="automating-analysis.html#cb403-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb403-13"><a href="automating-analysis.html#cb403-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>), </span>
<span id="cb403-14"><a href="automating-analysis.html#cb403-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb403-15"><a href="automating-analysis.html#cb403-15" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## Error in fortify(data): object &#39;fedranked&#39; not found</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="geographic-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="automating-geographic-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/21-automatinganalysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["datajournalism.pdf", "datajournalism.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
